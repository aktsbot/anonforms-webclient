import{u as S,r as a,D as y,a as f,j as e,P as R,m as _,k as D,g as j,l as E}from"./index-CXqG7qat.js";function F(){const{form_uri:r}=S(),l=a.useContext(y),[o,g]=a.useState({title:"..."}),[w,b]=a.useState([]),[k,C]=a.useState(0),[n,p]=a.useState(1),[u,v]=a.useState(1),[m,i]=a.useState(0);a.useEffect(()=>{const s=f.CancelToken.source();async function c(){try{const t=await D({form_uri:r,page:n,req_cancel_token:s.token});g(t.data.form),b(t.data.responses),C(t.data.count),v(t.data.total_pages)}catch(t){l({type:"alertMessage",value:j(t),message_type:"danger",heading:"Error"})}}return c(),()=>s.cancel()},[l,n,r]),a.useEffect(()=>{const s=f.CancelToken.source();async function c(){try{const t=await E({form_uri:r,req_cancel_token:s.token}),x=o.title.toLowerCase().replace(/ /g,"-")+".csv";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(new Blob([t]),x);else{const N=window.URL.createObjectURL(new Blob([t])),d=document.createElement("a");d.href=N,d.setAttribute("download",x),document.body.appendChild(d),d.click()}i(0)}catch(t){l({type:"alertMessage",value:j(t),message_type:"danger",heading:"Error"}),i(0)}}return m&&c(),()=>{i(0),s.cancel()}},[m,r,l,o.title]);function h(s){s==="p"&&n!==1&&p(n-1),s==="n"&&n<u&&p(n+1)}return e.jsxs(R,{title:`${o.title} responses`,showHeader:!0,children:[e.jsx("h1",{className:"head-underline",children:`${o.title} responses`}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Response from + date YYYY/MM/DD"}),e.jsx("th",{children:"Attempted"})]})}),e.jsx("tbody",{children:w.map((s,c)=>e.jsxs("tr",{children:[e.jsx("td",{children:c+1}),e.jsxs("td",{children:[s.response_from," -"," ",e.jsx("small",{children:e.jsx("code",{children:_(s.createdAt)})})]}),e.jsxs("td",{children:[s.answered,"/",o.question_count]})]},s.uuid))})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col c4",children:[n>1&&e.jsx("button",{className:"btn-link",onClick:()=>h("p"),children:"<PrevÂ "}),"Page ",n," of ",u+" ",n<u&&e.jsx("button",{className:"btn-link",onClick:()=>h("n"),children:"Next>"})]}),e.jsxs("div",{className:"col c4",children:[k," total responses"]}),e.jsx("div",{className:"col c4",children:e.jsx("button",{className:"btn btn-sm btn-a",onClick:()=>{m===0&&i(1)},children:"Download responses as csv file"})})]})]})}export{F as default};

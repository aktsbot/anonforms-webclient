import{r as a,D as x,e as p,a as l,j as e,P as y,c as u,d as g,g as i,f,h as j}from"./index-CXqG7qat.js";function T(){const c=a.useContext(x),d={sessions:[],sessionToDelete:null,accountDeleteText:"Delete my account",confirmDeleteText:"",deleteAccount:!1,formAuthorInfo:{uuid:"",createdAt:""}},h=(s,n)=>{switch(n.type){case"sessions":s.sessions=n.value;return;case"formAuthorInfo":s.formAuthorInfo=n.value;return;case"sessionToDelete":s.sessionToDelete=n.value;return;case"sessionDeleted":const o=s.sessionToDelete;s.sessions=s.sessions.filter(m=>m.session_token!==o),s.sessionToDelete=null;return;case"deleteAccount":s.deleteAccount=!0;return;case"confirmDeleteText":s.confirmDeleteText=n.value;return;default:return}},[t,r]=p(h,d);return a.useEffect(()=>{const s=l.CancelToken.source();async function n(){try{const o=await g({req_cancel_token:s.token});o.data.sessions&&r({type:"sessions",value:o.data.sessions}),o.data.user&&r({type:"formAuthorInfo",value:o.data.user})}catch(o){c({type:"alertMessage",value:i(o),message_type:"danger",heading:"Error"})}}return n(),()=>s.cancel()},[c,r]),a.useEffect(()=>{const s=l.CancelToken.source();async function n(){try{await f({session_token:t.sessionToDelete,req_cancel_token:s.token}),c({type:"alertMessage",value:"Session has been removed",message_type:"success",heading:"Success!"}),r({type:"sessionDeleted"})}catch(o){c({type:"alertMessage",value:i(o),message_type:"danger",heading:"Error"})}}t.sessionToDelete&&n()},[t.sessionToDelete,c,r]),a.useEffect(()=>{const s=l.CancelToken.source();async function n(){try{await j({session_token:t.sessionToDelete,req_cancel_token:s.token}),c({type:"alertMessage",value:"Your account has been deleted",message_type:"success",heading:"Success!"}),c({type:"logout"})}catch(o){c({type:"alertMessage",value:i(o),message_type:"danger",heading:"Error"})}}t.deleteAccount&&n()},[t.deleteAccount,c,t.sessionToDelete]),e.jsxs(y,{title:"Account",showHeader:!0,children:[e.jsx("h1",{className:"head-underline",children:"Account"}),e.jsxs("p",{children:["Account ID:"," ",e.jsx("strong",{children:e.jsx("code",{children:t.formAuthorInfo.uuid})})]}),e.jsxs("p",{children:["Created on: ",u(t.formAuthorInfo.createdAt)]}),e.jsx("h2",{className:"head-underline",children:"Sessions"}),e.jsxs("div",{className:"msg",children:["Your logged in sessions from different web browsers will be listed here. You may remove sessions ",e.jsx("strong",{children:"other than your current"})," ","session."]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Session token"}),e.jsx("th",{children:"Last used on"}),e.jsx("th",{children:" "})]})}),e.jsx("tbody",{children:t.sessions.map((s,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:n+1}),e.jsxs("td",{children:[s.session_token," "]}),e.jsx("td",{children:u(s.session_last_used)}),e.jsx("td",{children:s.is_current?e.jsx("small",{children:"Current"}):e.jsx("button",{className:"btn-link",onClick:()=>r({type:"sessionToDelete",value:s.session_token}),children:"Remove this session"})})]},s.session_token))})]}),e.jsx("h2",{className:"head-underline",children:"Delete my account"}),e.jsxs("div",{className:"msg warning",children:["This will delete all your forms, their responses and anything related to you on the platform."," ",e.jsx("strong",{children:"Your account will be permanently deleted."})]}),e.jsxs("p",{children:["To delete your account enter"," ",e.jsxs("strong",{children:['"',t.accountDeleteText,'"']})," below."]}),e.jsx("input",{type:"text",onChange:s=>r({type:"confirmDeleteText",value:s.target.value}),className:"smooth w-100",placeholder:"Type it here"}),e.jsx("div",{className:"m-y-sm",children:e.jsx("button",{className:"btn btn-sm btn-c",disabled:t.accountDeleteText!==t.confirmDeleteText,onClick:()=>r({type:"deleteAccount"}),children:"Delete account"})})]})}export{T as default};
